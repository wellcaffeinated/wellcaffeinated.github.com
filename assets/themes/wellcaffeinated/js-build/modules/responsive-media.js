/*
		 * Copyright (c) 2010 Nicholas C. Zakas. All rights reserved.
		 * http://www.nczonline.net/
		 */

define(["jquery","./pubsub","plugins/domReady!"],function(e,t){function c(e){var t=!1;return l?t=u(e).matches:(a||(a=o.document.createElement("div"),a.id="matchmedia-m-1",a.style.cssText="position:absolute;top:-1000px",o.document.body.insertBefore(a,o.document.body.firstChild)),a.innerHTML='_<style media="'+e+'"> #matchmedia-m-1 { width: 1px; }</style>',a.removeChild(a.firstChild),t=a.offsetWidth==1),s[e]=t,t}function h(s,a){var c;r[s]||(r[s]=t(n+"/"+s)),c=r[s],l&&!i[s]&&(e.browser.webkit&&(f||(f=o.document.createElement("style"),o.document.getElementsByTagName("head")[0].appendChild(f)),f.appendChild(o.document.createTextNode("@media "+s+" { .-matchmedia-m {} }"))),i[s]=u(s),i[s].addListener(function(e){c.publish({media:s,matches:e.matches})})),i[s]||(i[s]=1),c.subscribe(a)}function p(e,t){r[e].unsubscribe(t)}var n="/responsive/media",r={},i={},s={},o=window,u=o.matchMedia||o.msMatchMedia,a,f,l=!!u;return l||e(o).on("resize",function(){var e,t,n,r;for(e in i)i.hasOwnProperty(e)&&(t=i[e],r=s[e],n=c(e),n!==r&&connect.publish(e,[{media:e,matches:n}]))}),e.extend({channel:n,matches:c,subscribe:h,unsubscribe:p})})